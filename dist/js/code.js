var timer,rows=25,cols=60,playing=!1,grid=new Array(rows),nextGrid=new Array(rows),reproductionTime=100;function initializeGrids(){for(var e=0;e<rows;e++)grid[e]=new Array(cols),nextGrid[e]=new Array(cols)}function resetGrids(){for(var e=0;e<rows;e++)for(var t=0;t<cols;t++)grid[e][t]=0,nextGrid[e][t]=0}function copyAndResetGrid(){for(var e=0;e<rows;e++)for(var t=0;t<cols;t++)grid[e][t]=nextGrid[e][t],nextGrid[e][t]=0}function initialize(){createTable(),initializeGrids(),resetGrids(),setupControlButtons()}function setSize(){n_rows=document.getElementById("heightIn").value,n_cols=document.getElementById("widthIn").value,rows=n_rows,cols=n_cols;document.getElementById("gridContainer").innerHTML="";var e=document.getElementById("gridContainer");if(e){for(var t=document.createElement("table"),r=0;r<rows;r++){for(var n=document.createElement("tr"),o=0;o<cols;o++){var i=document.createElement("td");i.setAttribute("id",r+"_"+o),i.setAttribute("class","dead"),i.onclick=cellClickHandler,n.appendChild(i)}t.appendChild(n)}e.appendChild(t)}else console.error("Problem: No div for the drid table!")}function createTable(){var e=document.getElementById("gridContainer");e||console.error("Problem: No div for the drid table!");var t=document.createElement("table");rows=document.getElementById("heightIn").value,cols=document.getElementById("widthIn").value;for(var r=0;r<rows;r++){for(var n=document.createElement("tr"),o=0;o<cols;o++){var i=document.createElement("td");i.setAttribute("id",r+"_"+o),i.setAttribute("class","dead"),i.onclick=cellClickHandler,n.appendChild(i)}t.appendChild(n)}e.appendChild(t)}function cellClickHandler(){var e=this.id.split("_"),t=e[0],r=e[1];-1<this.getAttribute("class").indexOf("live")?(this.setAttribute("class","dead"),grid[t][r]=0):(this.setAttribute("class","live"),grid[t][r]=1)}function updateView(){for(var e=0;e<rows;e++)for(var t=0;t<cols;t++){var r=document.getElementById(e+"_"+t);0==grid[e][t]?r.setAttribute("class","dead"):r.setAttribute("class","live")}}function setupControlButtons(){document.getElementById("start").onclick=startButtonHandler,document.getElementById("clear").onclick=clearButtonHandler,document.getElementById("random").onclick=randomButtonHandler}function randomButtonHandler(){if(!playing){clearButtonHandler();for(var e=0;e<rows;e++)for(var t=0;t<cols;t++){if(1==Math.round(Math.random()))document.getElementById(e+"_"+t).setAttribute("class","live"),grid[e][t]=1}}}function levelChange(){var e=document.getElementById("level").value;e.split("\n");for(var t=0;t<e.length;t++)for(var r=0;r<rows;r++)for(var n=0;n<cols;n++){var o=e[n][r];if(1==o)document.getElementById(r+"_"+n).setAttribute("class","live");else if(0==o){document.getElementById(r+"_"+n).setAttribute("class","dead")}}}function clearButtonHandler(){console.log("Clear the game: stop playing, clear the grid"),playing=!1,document.getElementById("start").innerHTML="Start",clearTimeout(timer);for(var e=document.getElementsByClassName("live"),t=[],r=0;r<e.length;r++)t.push(e[r]);for(r=0;r<t.length;r++)t[r].setAttribute("class","dead")}function startButtonHandler(){playing?(console.log("Pause the game"),playing=!1,this.innerHTML="Continue",clearTimeout(timer)):(console.log("Continue the game"),playing=!0,this.innerHTML="Pause",play())}function play(){computeNextGen(),playing&&(timer=setTimeout(play,reproductionTime))}function computeNextGen(){for(var e=0;e<rows;e++)for(var t=0;t<cols;t++)applyRules(e,t);copyAndResetGrid(),updateView()}function applyRules(e,t){var r=countNeighbors(e,t);1==grid[e][t]?r<2?nextGrid[e][t]=0:2==r||3==r?nextGrid[e][t]=1:3<r&&(nextGrid[e][t]=0):0==grid[e][t]&&3==r&&(nextGrid[e][t]=1)}function countNeighbors(e,t){var r=0;return 0<=e-1&&1==grid[e-1][t]&&r++,0<=e-1&&0<=t-1&&1==grid[e-1][t-1]&&r++,0<=e-1&&t+1<cols&&1==grid[e-1][t+1]&&r++,0<=t-1&&1==grid[e][t-1]&&r++,t+1<cols&&1==grid[e][t+1]&&r++,e+1<rows&&1==grid[e+1][t]&&r++,e+1<rows&&0<=t-1&&1==grid[e+1][t-1]&&r++,e+1<rows&&t+1<cols&&1==grid[e+1][t+1]&&r++,r}window.onload=initialize;